PR-01: Add component-prompt2flow (flow-only router + options card)
Goal

Create a new component that:

reads prompt2flow.json

decides whether to route to another flow/node within the same pack

otherwise falls through

Behavior

Input: ChannelMessageEnvelope + optional action payload

Determine “routing mode”:

If action payload contains route.flow → commit route (highest priority)

Else if mode.require_prefix == true:

only treat as routing if message starts with any prefix in mode.prefixes

Else:

treat as routing whenever message non-empty (less safe; default off)

Matching (Jaccard over token sets):

tokenize query

for each intent: tokenize title + examples + keywords + anchors

compute Jaccard

if anchors non-empty: require at least one anchor in intersection

pick top-K

if top1 >= min_score and top1-top2 >= min_gap → route to intent.route

else → emit “options card” listing top-K intents with example prompts + buttons that re-invoke with action payload route

Output contract

Return something your runtime understands, e.g. one of:

Routing::ToFlow { flow_id, node_id?, args? }

or a FollowGraph directive

or produce a card + wait for user click

Files to add

components/prompt2flow/ (crate or component directory)

src/lib.rs with the component implementation

src/tokenize.rs helper

src/jaccard.rs helper

src/render_options_card.rs helper

tests/ unit tests for:

prefix gating

anchor enforcement

top1/top2 gap threshold

click route payload overrides scoring

Acceptance

Component compiles and can be executed standalone in tests with a fake envelope.

Given config + prompt, it routes correctly or produces options card.